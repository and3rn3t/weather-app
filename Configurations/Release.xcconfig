//
// Release.xcconfig
// Andernet Weather - Release Build Configuration
//
// Usage: Assigned to Project > Info > Configurations > Release
// Includes Warnings.xcconfig for shared warning/analyzer settings
//

#include "Warnings.xcconfig"

// MARK: - Compilation Optimization

// Optimize for speed
SWIFT_OPTIMIZATION_LEVEL = -O
GCC_OPTIMIZATION_LEVEL = s

// Whole module optimization for better cross-module inlining
SWIFT_COMPILATION_MODE = wholemodule

// Build all architectures for distribution
ONLY_ACTIVE_ARCH = NO

// MARK: - Link-Time Optimization (LTO)

// Incremental LTO for smaller, faster binaries
LLVM_LTO = YES_THIN

// MARK: - Binary Size Optimization

// Strip debug symbols from installed product
STRIP_INSTALLED_PRODUCT = YES
STRIP_STYLE = non-global
COPY_PHASE_STRIP = YES

// Dead code stripping removes unused code
DEAD_CODE_STRIPPING = YES

// Strip Swift symbols to reduce binary size
STRIP_SWIFT_SYMBOLS = YES

// MARK: - Debug Symbols (for crash reports)

// Generate dSYM for crash symbolication
DEBUG_INFORMATION_FORMAT = dwarf-with-dsym

// No Metal debug info in Release
MTL_ENABLE_DEBUG_INFO = NO

// MARK: - Assertions

// Disable assertions in production
ENABLE_NS_ASSERTIONS = NO
GCC_PREPROCESSOR_DEFINITIONS = NDEBUG=1 $(inherited)

// MARK: - Validation

VALIDATE_PRODUCT = YES

// Verify module interfaces are well-formed before shipping
ENABLE_MODULE_VERIFIER = YES

// MARK: - Cross-Module Optimization

// Allow optimizer to inline and specialize across module boundaries
SWIFT_CROSS_MODULE_OPTIMIZATION = YES

// MARK: - Binary Metadata Reduction

// Strip Swift reflection metadata — smaller binary, no runtime Mirror usage needed
SWIFT_REFLECTION_METADATA_LEVEL = none

// Don't serialize debug options into the binary
SWIFT_SERIALIZE_DEBUGGING_OPTIONS = NO

// MARK: - Build Speed

// Disable index store in Release/CI builds — not needed for distribution
COMPILER_INDEX_STORE_ENABLE = NO

// Fuse script phases for faster builds
FUSE_BUILD_SCRIPT_PHASES = YES

// MARK: - Asset Catalog

// Optimize asset catalog for smaller binary size
ASSETCATALOG_COMPILER_OPTIMIZATION = space

// MARK: - Previews

// Disable SwiftUI preview injection in Release builds
ENABLE_PREVIEWS = NO

// MARK: - Warnings as Errors

// Enforce zero warnings in distribution builds
SWIFT_TREAT_WARNINGS_AS_ERRORS = YES
GCC_TREAT_WARNINGS_AS_ERRORS = YES

// MARK: - Compiler Flags

// Clear debug-only Swift flags (type-check warnings slow Release compilation)
OTHER_SWIFT_FLAGS = $(inherited)
